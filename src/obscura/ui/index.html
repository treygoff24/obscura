<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obscura</title>
    <link rel="stylesheet" href="styles.css">
    <style>.skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;z-index:999}.skip-link:focus{position:static;width:auto;height:auto;padding:8px 16px;background:var(--accent);color:#fff;text-decoration:none;border-radius:6px;margin:8px}</style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Screen 1: Welcome -->
    <div id="screen-welcome" class="screen active">
        <main id="main-content" class="welcome-container">
            <h1>Obscura</h1>
            <p class="tagline">Black out sensitive words from your PDFs</p>
            <div class="welcome-steps">
                <div class="welcome-step">
                    <span class="step-icon" aria-hidden="true">1</span>
                    <h2>Add your words</h2>
                    <p>Type the words or phrases you want removed</p>
                </div>
                <div class="welcome-step">
                    <span class="step-icon" aria-hidden="true">2</span>
                    <h2>Drop in your PDFs</h2>
                    <p>Drag files or browse to select them</p>
                </div>
                <div class="welcome-step">
                    <span class="step-icon" aria-hidden="true">3</span>
                    <h2>Get clean documents</h2>
                    <p>Obscura blacks out every match and verifies the result</p>
                </div>
            </div>
            <button id="get-started-btn" class="btn-primary btn-lg">Get Started</button>
            <p class="welcome-note">You'll choose a folder to store your projects</p>
        </main>
    </div>

    <!-- Screen 2: Project List -->
    <div id="screen-projects" class="screen">
        <header>
            <h1>Your Projects</h1>
            <button id="new-project-btn" class="btn-primary">New Project</button>
        </header>
        <main id="project-list">
            <div id="project-list-body">
                <p class="empty-state">Loading projects...</p>
            </div>
        </main>
    </div>

    <!-- Screen 3: Workspace -->
    <div id="screen-workspace" class="screen">
        <header>
            <button id="back-to-projects" class="btn-back"><span aria-hidden="true">&larr;</span> Back</button>
            <h1 id="workspace-title">Project</h1>
        </header>

        <nav class="stepper" role="tablist">
            <button id="tab-keywords" class="step-tab active" data-step="keywords" role="tab" aria-selected="true" aria-controls="step-keywords">
                <span class="step-number" aria-hidden="true">1</span> Words to redact
            </button>
            <button id="tab-files" class="step-tab" data-step="files" role="tab" aria-selected="false" aria-controls="step-files">
                <span class="step-number" aria-hidden="true">2</span> Your documents
            </button>
            <button id="tab-run" class="step-tab" data-step="run" role="tab" aria-selected="false" aria-controls="step-run">
                <span class="step-number" aria-hidden="true">3</span> Redact
            </button>
        </nav>

        <main>
        <!-- Step 1: Keywords -->
        <section id="step-keywords" class="step-panel active" role="tabpanel" aria-labelledby="tab-keywords">
            <div class="step-content">
                <h2>What words should be blacked out?</h2>
                <p class="step-desc">Type one word or phrase per line. Every match will be covered with a black box in your PDFs.</p>
                <div class="keywords-wrap">
                    <label class="sr-only" for="keywords-editor">Words to redact</label>
                    <textarea id="keywords-editor" placeholder="Type words to redact, one per line&#10;&#10;Example:&#10;John Smith&#10;Acme Corp&#10;confidential" spellcheck="false"></textarea>
                    <span id="save-indicator" class="save-indicator" aria-live="polite"></span>
                </div>
                <div id="keyword-errors" class="validation-error hidden" aria-live="assertive"></div>
                <details class="advanced-section">
                    <summary>Advanced: pattern matching</summary>
                    <p>Append <code>*</code> to match prefixes (e.g. <code>investor*</code> matches "investors", "investor-relations").</p>
                    <p>Prefix a line with <code>regex:</code> to use a regular expression (e.g. <code>regex:\binvestor\b</code>).</p>
                </details>
                <button id="step-next-files" class="btn-primary btn-next">Next: Add documents <span aria-hidden="true">&rarr;</span></button>
            </div>
        </section>

        <!-- Step 2: Files -->
        <section id="step-files" class="step-panel" role="tabpanel" aria-labelledby="tab-files">
            <div class="step-content">
                <h2>Add your PDF documents</h2>
                <p class="step-desc">Drop files below or click to browse. Only PDF files are accepted.</p>
                <div id="file-drop" class="file-drop-zone">
                    <div class="drop-illustration"><span aria-hidden="true">&#128196;</span></div>
                    <p class="drop-text">Drag and drop PDFs here</p>
                    <button id="add-files-btn" class="btn-secondary">Browse files</button>
                </div>
                <div id="file-list"></div>
                <span id="file-count" class="file-count"></span>
                <div class="step-nav">
                    <button id="step-prev-keywords" class="btn-secondary btn-prev"><span aria-hidden="true">&larr;</span> Words</button>
                    <button id="step-next-run" class="btn-primary btn-next">Next: Redact <span aria-hidden="true">&rarr;</span></button>
                </div>
            </div>
        </section>

        <!-- Step 3: Run -->
        <section id="step-run" class="step-panel" role="tabpanel" aria-labelledby="tab-run">
            <div class="step-content">
                <h2>Ready to redact</h2>
                <p class="step-desc">Obscura will black out every matching word and verify the results.</p>
                <button id="run-btn" class="btn-run">Redact my documents</button>
                <div id="run-progress" class="run-progress hidden">
                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Redaction progress">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="progress-text" aria-live="polite">Processingâ€¦</p>
                </div>
                <div id="run-summary" class="run-summary hidden" aria-live="polite">
                    <div id="summary-verdict"></div>
                    <div class="summary-stats">
                        <div class="stat">
                            <span id="sum-files" class="stat-value">0</span>
                            <span class="stat-label">documents processed</span>
                        </div>
                        <div class="stat">
                            <span id="sum-redactions" class="stat-value">0</span>
                            <span class="stat-label">words blacked out</span>
                        </div>
                        <div class="stat">
                            <span id="sum-review" class="stat-value">0</span>
                            <span class="stat-label">need your attention</span>
                        </div>
                    </div>
                    <div class="summary-actions">
                        <button id="open-output-btn" class="btn-secondary" type="button">Open output folder</button>
                        <button id="view-files-btn" class="btn-secondary" type="button">View file details</button>
                    </div>
                </div>
                <details class="advanced-section">
                    <summary>Settings</summary>
                    <div class="setting-row">
                        <label for="language-select">Document language</label>
                        <select id="language-select">
                            <option value="eng" selected>English</option>
                            <option value="spa">Spanish</option>
                            <option value="eng+spa">English + Spanish</option>
                        </select>
                    </div>
                    <div class="setting-row checkbox-setting">
                        <input type="checkbox" id="deep-verify-check">
                        <label for="deep-verify-check">Double-check with OCR scan</label>
                    </div>
                    <div id="dpi-row" class="setting-row hidden">
                        <label for="dpi-select">Scan quality</label>
                        <select id="dpi-select">
                            <option value="150">Low / faster</option>
                            <option value="300" selected>Medium</option>
                            <option value="400">High</option>
                            <option value="600">Maximum / slower</option>
                        </select>
                    </div>
                </details>
                <button id="step-prev-files" class="btn-secondary btn-prev"><span aria-hidden="true">&larr;</span> Documents</button>
            </div>
        </section>
        </main>
    </div>

    <!-- Screen 4: Report Detail -->
    <div id="screen-report" class="screen">
        <header>
            <button id="back-to-workspace" class="btn-back"><span aria-hidden="true">&larr;</span> Back</button>
            <h1 id="report-title">File Report</h1>
        </header>
        <main class="report-body">
            <div id="report-verdict" class="report-verdict"></div>
            <div class="report-actions">
                <button id="open-preview-btn" class="btn-primary">Open redacted PDF</button>
                <button id="reveal-finder-btn" class="btn-secondary">Show in folder</button>
            </div>

            <section id="report-residual" class="report-section hidden">
                <h2>Words that may still be visible</h2>
                <p class="section-note">These words were found in the redacted document. Please open the PDF and check these pages manually.</p>
                <table id="residual-table">
                    <caption class="sr-only">Residual matches found in redacted document</caption>
                    <thead>
                        <tr><th>Word</th><th>Page</th><th>Found by</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>

            <section id="report-lowconf" class="report-section hidden">
                <h2>Pages that couldn't be read clearly</h2>
                <p class="section-note">The text on these pages was hard to read. You may want to check them yourself.</p>
                <div id="lowconf-pages"></div>
            </section>

            <section id="report-unreadable" class="report-section hidden">
                <h2>Pages we couldn't check</h2>
                <div id="unreadable-warning" class="warning-box"></div>
                <div id="unreadable-pages"></div>
            </section>

            <section id="report-clean" class="report-section">
                <h2>Verified clean pages</h2>
                <div id="clean-pages"></div>
            </section>

            <details class="advanced-section">
                <summary>Technical details</summary>
                <div class="meta-grid">
                    <span class="meta-label">Words blacked out</span>
                    <span id="meta-redactions" class="meta-value"></span>
                    <span class="meta-label">OCR double-check</span>
                    <span id="meta-deepverify" class="meta-value"></span>
                    <span class="meta-label">Document language</span>
                    <span id="meta-language" class="meta-value"></span>
                    <span class="meta-label">Confidence threshold</span>
                    <span id="meta-threshold" class="meta-value"></span>
                    <span class="meta-label">Processed at</span>
                    <span id="meta-timestamp" class="meta-value"></span>
                </div>
            </details>
        </main>
    </div>

    <!-- Modal System -->
    <div id="modal-overlay" class="modal-overlay hidden" aria-hidden="true">
        <div id="modal-new-project" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modal-new-project-title" aria-describedby="modal-new-project-desc">
            <h2 id="modal-new-project-title">Create new project</h2>
            <p id="modal-new-project-desc">Each project has its own word list and set of documents.</p>
            <div class="modal-field">
                <label for="modal-project-name">Project name</label>
                <input type="text" id="modal-project-name" name="project_name" autocomplete="off" placeholder="e.g. Q1 Board Report">
            </div>
            <div class="modal-field">
                <label for="modal-project-language">Document language</label>
                <select id="modal-project-language">
                    <option value="eng" selected>English</option>
                    <option value="spa">Spanish</option>
                    <option value="eng+spa">English + Spanish</option>
                </select>
            </div>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="btn-secondary">Cancel</button>
                <button id="modal-create-btn" class="btn-primary">Create</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

    <script src="app.js"></script>
</body>
</html>
